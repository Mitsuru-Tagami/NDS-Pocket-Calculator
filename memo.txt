NDS日本語表示に関する覚書

## 目標
ニンテンドーDSの上下両方の画面に、カスタムの日本語ビットマップフォントを使って文字列を描画する。

## 判明したこと・学び

1.  **上画面のフレームバッファ化:**
    - `videoSetMode(MODE_FB0);` と `vramSetBankA(VRAM_A_LCD);` を使うことで、VRAMバンクAを上画面のフレームバッファとして直接制御できる。これは最もシンプルで確実な方法だった。

2.  **フォントデータのエンコーディング:**
    - プロジェクトに含まれていた `mplus_font_10x10` フォントデータは、一般的なUnicodeではなく、**Shift_JIS**の文字コードをインデックスとしてグリフが格納されていた。
    - そのため、`L"あ"` のようなワイド文字リテラル（Unicode）を直接渡しても描画されず、`0x82a0` のようなShift_JISコードを直接指定することで初めて描画に成功した。
    - これに対応するため、Shift_JISのバイト列を解釈し、文字コードを切り出して描画関数に渡す `drawStringSjis` 関数を実装した。

3.  **下画面のフレームバッファ化の試みと失敗:**
    - 上画面と異なり、下画面のフレームバッファ化は非常に困難だった。
    - `videoSetModeSub(MODE_5_2D);` と `bgInitSub()` を使い、VRAMバンクCやDを割り当てる標準的な方法を試したが、いかなる設定（背景ID 2または3）でも画面は黒いままとなり、ピクセルを直接書き込んでも表示されなかった。
    - これは、`libnds`の仕様、VRAMバンクの競合、あるいはDSハードウェアの特定の制約など、ドキュメントがないと解決が難しい問題である可能性が高いと結論付けた。

4.  **DSメニュー表示名の問題:**
    - `Makefile`の`GAME_TITLE`で日本語（Shift_JISバイト列）を設定しようと試みたが、DSメニュー上では文字化けが発生した。
    - 最終的に英語の「Simple Clock」を設定することで表示はされたが、`Makefile`で設定していない「ツール名」や「URL」といった余分な文字列が自動的に付加されてしまうことが判明した。
    - これは`devkitPro`のビルドツール（特に`ndstool`）の仕様によるもので、`Makefile`からの制御は困難であると判断した。

## 最終的な構成

以上の学びから、安定動作を最優先とし、以下の構成でアプリケーションを完成させた。

- **上画面:** フレームバッファモード (`MODE_FB0`) で、Shift_JIS対応の自作描画関数 `drawStringSjis` を使い、日本語で日付と時刻を表示。
- **下画面:** 従来の安定した標準コンソール機能 (`consoleInit`) を利用。これにより、表示はASCII文字（英語）に限定されるが、確実な動作を保証する。

## 画像と音楽の読み込みに関する現在の状況

*   **目標:** VNDSエンジンで画像と音楽を表示・再生する。
*   **初期テスト結果:** 一般的なJPG、PNG、MP3ファイルはDS上で表示・再生されず、エラーも報告されなかった。テキストは正常に表示された。
*   **`コマンド一覧.txt` からの知見:**
    *   **画像:** 背景は256x192ピクセルのJPGまたはPNG、スプライトはPNG。カラー深度は8ビット/ピクセルでディザリング推奨。内部的には16ビットカラー（RGB555）に変換される。
    *   **音楽 (BGM):** MP3形式。
    *   **サウンドエフェクト:** 22050Hz、1チャンネルのraw imadpcm形式。
*   **変換ツールの問題:** 提供された `.exe` 変換ツール（`pngnq`、`ima2raw`）はWineで起動しなかった。
*   **代替変換の試み:** `convert` (ImageMagick) を使用して画像を8ビットパレットPNGに変換したが、DSで表示されなかった。
*   **さらなる調査とテスト:** VNDSソースコードの分析から、DSが直接16ビットRGB555画像を好む/要求する可能性が浮上。単色の赤と青の16ビットRGB PNGを作成してテストしたが、これもDSで表示されなかった。
*   **現状の課題:** ファイルは存在し、一般的な意味では有効な形式だが、DS上で表示・再生されない。VNDSエンジンはエラーを報告しないため、デバッグが困難。VNDSエンジンが期待する非常に厳密な画像/音声フォーマット要件があるか、VNDSビルド自体に問題がある可能性が考えられる。